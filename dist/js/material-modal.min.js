/*!
 * Material Modal v0.1.2
 * Copyright 2016 Mark Rabey <mark@markrabey.com> (markrabey.com)
 * Licensed under the MIT license
 */


for(var MaterialModal=function(a){"use strict";this.trigger=a,this.initModal=function(){var a=this.trigger.dataset.modal,b=a.length,c=a.substring(1,b),d=document.getElementById(c);if(d)this.modal=d,this.setElements(),this.bindActions();else if(this.trigger.dataset.hasOwnProperty("modalSrc")){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a;this.trigger.dataset.hasOwnProperty("modalTarget")?(a=document.querySelector(this.trigger.dataset.modalTarget),a||console.error("Invalid modal-target property on this.trigger")):(a=document.createElement("div"),document.body.adopt(a)),a.innerHTML=e.responseText,d=document.getElementById(c),d?(this.modal=d,this.setElements(),this.bindActions()):console.error("No modal corresponding to this.trigger in loaded content")}}.bind(this),e.open("GET",this.trigger.dataset.modalSrc,!0),e.send()}else console.error("Missing modal and no modal-src for async loading")},this.setElements=function(){this.content=this.modal.querySelector(".modal__content"),this.closers=this.modal.querySelector(".modal__close"),this.modalsbg=this.modal.querySelector(".modal__bg"),this.modalsbg||(this.modalsbg=[]),/modal__bg/.test(this.modal.className)&&this.modalsbg.push(this.modal)},this.bindActions=function(){this.trigger.addEventListener("click",this.open.bind(this),!1);for(var a=0;a<this.closers.length;a++)this.closers[a].addEventListener("click",this.close.bind(this),!1);for(var a=0;a<this.modalsbg.length;a++)this.modalsbg[a].addEventListener("click",this.close.bind(this),!1)},this.close=function(a){function b(){setTimeout(function(){window.requestAnimationFrame(function(){d.remove()})},e-50)}var c=a.target,d=document.getElementById("modal__temp"),e=400;(this.isOpen&&c.classList.contains("modal__bg")||c.classList.contains("modal__close"))&&(a.preventDefault(),a.stopImmediatePropagation(),d.style.opacity="1",d.removeAttribute("style"),this.trigger.style.transform="none",this.trigger.style.webkitTransform="none",this.trigger.classList.remove("modal__trigger--active"),this.modal.classList.remove("modal--active"),this.content.classList.remove("modal__content--active"),d.addEventListener("transitionend",b,!1),this.isOpen=!1)},this.open=function(a){a.preventDefault();var b=a.target,c=400,d=function(a){var b=document.getElementById("modal__temp");if(null===b){var c=document.createElement("div");c.id="modal__temp",a.appendChild(c),c.style.backgroundColor=window.getComputedStyle(a).backgroundColor,e(a,c)}}.bind(this),e=function(a,b){var d,e,g,h,i=a.getBoundingClientRect(),j=this.modal.querySelector(".modal__content").getBoundingClientRect(),k=window.innerWidth/2,l=window.innerHeight/2;a.classList.add("modal__trigger--active"),g=j.width/i.width,h=j.height/i.height,g=g.toFixed(3),h=h.toFixed(3),d=Math.round(k-i.left-i.width/2),e=Math.round(l-i.top-i.height/2),this.modal.classList.contains("modal--align-top")&&(e=Math.round(j.height/2+j.top-i.top-i.height/2)),a.style.transform="translate("+d+"px, "+e+"px)",a.style.webkitTransform="translate("+d+"px, "+e+"px)",b.style.backgroundColor="#fff",b.style.transform="scale("+g+","+h+")",b.style.webkitTransform="scale("+g+","+h+")",window.setTimeout(function(){window.requestAnimationFrame(function(){f(b)})},c)}.bind(this),f=function(a){if(!this.isOpen){var b=this.modal.querySelector(".modal__content");this.modal.classList.add("modal--active"),b.classList.add("modal__content--active");var c=function(){g(a)};b.addEventListener("transitionend",c,!1),this.isOpen=!0}}.bind(this),g=function(a){a.style.opacity="0",this.content.removeEventListener("transitionend",g,!1)}.bind(this);d(b)},this.initModal()},triggers=document.querySelectorAll(".modal__trigger"),modals=[],j=0;j<triggers.length;j++)new MaterialModal(triggers[j]);